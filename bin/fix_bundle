#!/bin/sh

version=${1:-2.7.2}
echo "Bundle will be updated to" "$version"

# Fix the bundler version in the Gemfile.lock and remove all platforms except the ruby one
bundle _"${version}"_ update --bundler \
  && bundle lock --add-platform ruby x86_64-linux x86_64-darwin-19 x86_64-darwin-20 x86_64-darwin-22 x86_64-darwin-23 arm64-darwin-22 arm64-darwin-23 arm64-darwin-24 \
  && bundle lock --remove-platform x86_64-linux x86_64-darwin-19 x86_64-darwin-20 x86_64-darwin-22 x86_64-darwin-23 arm64-darwin-22 arm64-darwin-23 arm64-darwin-24
